package active.scanner;

import active.http.HttpClient;
import active.model.ApiEndpoint;
import active.model.VulnerabilityReport;

import java.util.List;

/**
 * Интерфейс плагина для сканеров уязвимостей.
 * Реализации должны обнаруживать конкретные типы уязвимостей в эндпоинтах API.
 *
 * <p>Сканеры спроектированы как:
 * <ul>
 *   <li>Независимые - каждый сканер фокусируется на конкретном типе уязвимости</li>
 *   <li>Компонуемые - несколько сканеров могут применяться к одному эндпоинту</li>
 *   <li>Настраиваемые - сканеры могут иметь собственную конфигурацию</li>
 * </ul>
 *
 * <p>Реализации автоматически обнаруживаются через механизм ServiceLoader.
 */
public interface VulnerabilityScanner {

    /**
     * Возвращает уникальный идентификатор сканера.
     *
     * @return идентификатор сканера
     */
    String getId();

    /**
     * Возвращает человекочитаемое название сканера.
     *
     * @return название сканера
     */
    String getName();

    /**
     * Возвращает описание того, что обнаруживает этот сканер.
     *
     * @return описание сканера
     */
    String getDescription();

    /**
     * Возвращает типы уязвимостей, которые может обнаружить этот сканер.
     *
     * @return список типов уязвимостей
     */
    List<VulnerabilityReport.VulnerabilityType> getDetectedVulnerabilities();

    /**
     * Проверяет, применим ли этот сканер к данному эндпоинту.
     * Сканеры могут фильтровать эндпоинты для тестирования на основе различных критериев
     * (например, HTTP-метод, шаблоны путей, наличие параметров).
     *
     * @param endpoint эндпоинт API для проверки
     * @return true, если сканер должен тестировать этот эндпоинт
     */
    boolean isApplicable(ApiEndpoint endpoint);

    /**
     * Сканирует эндпоинт API на наличие уязвимостей.
     *
     * @param endpoint эндпоинт для сканирования
     * @param httpClient HTTP-клиент для выполнения тестовых запросов
     * @param context контекст сканирования с конфигурацией и состоянием
     * @return результат сканирования с обнаруженными уязвимостями
     */
    ScanResult scan(ApiEndpoint endpoint, HttpClient httpClient, ScanContext context);

    /**
     * Возвращает конфигурацию сканера.
     *
     * @return конфигурация сканера
     */
    ScannerConfig getConfig();

    /**
     * Устанавливает конфигурацию сканера.
     *
     * @param config конфигурация сканера
     */
    void setConfig(ScannerConfig config);
}
