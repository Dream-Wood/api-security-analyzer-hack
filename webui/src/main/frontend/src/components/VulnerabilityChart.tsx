import React from 'react';
import './VulnerabilityChart.css';

interface VulnerabilityCount {
  type: string;
  count: number;
}

interface VulnerabilityChartProps {
  vulnerabilities: any[];
  title?: string;
}

/**
 * Component that displays vulnerability types as horizontal bars
 * with gradients and animations
 */
export const VulnerabilityChart: React.FC<VulnerabilityChartProps> = ({
  vulnerabilities,
  title = "Vulnerability Distribution"
}) => {
  // Safety check: ensure vulnerabilities is an array
  if (!vulnerabilities || !Array.isArray(vulnerabilities)) {
    console.warn('VulnerabilityChart: vulnerabilities is not an array', vulnerabilities);
    return null;
  }

  // Count vulnerabilities by type
  const countByType = vulnerabilities.reduce((acc, vuln) => {
    if (!vuln) return acc;
    const type = vuln.type || 'Unknown';
    acc[type] = (acc[type] || 0) + 1;
    return acc;
  }, {} as Record<string, number>);

  // Convert to array and sort by count (descending)
  const sortedVulns: VulnerabilityCount[] = Object.entries(countByType)
    .map(([type, count]) => ({ type, count: count as number }))
    .sort((a, b) => b.count - a.count);

  if (sortedVulns.length === 0) {
    return null;
  }

  const maxCount = sortedVulns[0].count;

  // Bright, contrasting colors for different vulnerability types
  const getColorForIndex = (index: number): string => {
    const colors = [
      '#dc2626', // Red (Critical)
      '#ea580c', // Orange (High)
      '#f59e0b', // Amber (Medium)
      '#3b82f6', // Blue
      '#8b5cf6', // Purple
      '#ec4899', // Pink
      '#06b6d4', // Cyan
      '#10b981', // Green
      '#f97316', // Deep Orange
      '#6366f1', // Indigo
    ];

    return colors[index % colors.length];
  };

  return (
    <div className="vulnerability-chart">
      <h4 className="chart-title">{title}</h4>
      <div className="chart-bars">
        {sortedVulns.map((item, index) => {
          const percentage = (item.count / maxCount) * 100;

          return (
            <div key={item.type} className="chart-bar-container">
              <div className="chart-bar-header">
                <span className="chart-bar-label" title={item.type}>
                  {item.type}
                </span>
                <span className="chart-bar-count">{item.count}</span>
              </div>
              <div className="chart-bar-track">
                <div
                  className="chart-bar-fill"
                  style={{
                    width: `${percentage}%`,
                    backgroundColor: getColorForIndex(index)
                  }}
                />
              </div>
            </div>
          );
        })}
      </div>
    </div>
  );
};
